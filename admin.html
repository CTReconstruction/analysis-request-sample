<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin</title>

<style>
*{box-sizing:border-box;font-family:Segoe UI,Arial}

body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#667eea,#764ba2);
  padding:40px;
  position:relative;
  overflow-x:hidden;
}

body::before{
  content:"";
  position:absolute;
  width:700px;
  height:700px;
  background:radial-gradient(circle,rgba(255,255,255,0.25),transparent 60%);
  top:-200px;
  right:-200px;
  animation:float 8s ease-in-out infinite alternate;
}

@keyframes float{
  from{transform:translateY(0);}
  to{transform:translateY(40px);}
}

.container{
  max-width:1200px;
  margin:auto;
  backdrop-filter:blur(20px);
  background:rgba(255,255,255,0.15);
  border:1px solid rgba(255,255,255,0.3);
  padding:30px;
  border-radius:22px;
  box-shadow:0 25px 50px rgba(0,0,0,.35);
  color:#fff;
  position:relative;
  z-index:1;
}

h2{text-align:center;margin-bottom:25px;}

button{
  background:#ef4444;
  color:#fff;
  border:none;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
  transition:.3s;
}

button:hover{
  background:#dc2626;
  transform:translateY(-2px);
}

.view-btn{
  background:#3b82f6;
  padding:5px 10px;
  font-size:12px;
}

.view-btn:hover{
  background:#2563eb;
}

.modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.6);
  justify-content:center;
  align-items:center;
  z-index:999;
}

.modal-content{
  background:#fff;
  color:#000;
  width:500px;
  max-height:80vh;
  overflow:auto;
  padding:25px;
  border-radius:12px;
}

.modal-content h3{
  margin-top:0;
}

.close-btn{
  background:#ef4444;
  color:#fff;
  margin-top:15px;
}

.table-wrapper{overflow-x:auto;}

table{
  width:100%;
  border-collapse:collapse;
  min-width:1200px;
  background:rgba(255,255,255,0.1);
}

th, td{
  padding:12px;
  text-align:center;
  font-size:13px;
}

th{
  background:rgba(255,255,255,0.25);
}
</style>
</head>

<body>

<div class="container">

<h2>Admin Dashboard</h2>

<div class="table-wrapper">
<table>
<thead>
<tr>
<th>Date</th>
<th>Analysis</th>
<th>Requester</th>
<th>No Sample</th>
<th>Sample Name</th>
<th>Sample Code</th>
<th>Background</th>
<th>Purpose</th>
<th>Analysis Status</th>
<th>Completed Date</th>
<th>Report Status</th>
<th>Report Date</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

</div>

<!-- MODAL -->
<div class="modal" id="detailModal">
  <div class="modal-content">
    <h3>Sample Detail</h3>
    <p><strong>Background:</strong></p>
    <p id="modalBackground"></p>

    <p><strong>Purpose:</strong></p>
    <p id="modalPurpose"></p>

    <button class="close-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDh2gwpr4OM7tgvahKEf9Bd7hvUBuABQtU",
  authDomain: "analysis-request-sample.firebaseapp.com",
  projectId: "analysis-request-sample"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const tableBody = document.getElementById("tableBody");

function shortenText(text, max=40){
  if(!text) return "-";
  return text.length>max ? text.substring(0,max)+"..." : text;
}

function openModal(background,purpose){
  document.getElementById("modalBackground").innerText = background || "-";
  document.getElementById("modalPurpose").innerText = purpose || "-";
  document.getElementById("detailModal").style.display="flex";
}

window.closeModal=function(){
  document.getElementById("detailModal").style.display="none";
}

async function loadData(){
  const q = query(collection(db,"samples"), orderBy("date","asc"));
  const snap = await getDocs(q);

  tableBody.innerHTML="";

  snap.forEach(docSnap=>{
    const data = docSnap.data();

    const row=document.createElement("tr");

    row.innerHTML=`
      <td>${data.date||"-"}</td>
      <td>${data.analysisType||"-"}</td>
      <td>${data.requester||"-"}</td>
      <td>${data.noSample||"-"}</td>
      <td>${data.sampleName||"-"}</td>
      <td><strong>${data.sampleCode||"-"}</strong></td>

      <td>
        ${shortenText(data.backgroundSample)}
        <br>
        <button class="view-btn"
          onclick='openModal(${JSON.stringify(data.backgroundSample)},${JSON.stringify(data.purposeAnalysis)})'>
          View
        </button>
      </td>

      <td>
        ${shortenText(data.purposeAnalysis)}
      </td>

      <td>${data.analysisStatus||"Pending"}</td>
      <td>${data.analysisCompletedDate||"-"}</td>
      <td>${data.reportStatus||"Pending"}</td>
      <td>${data.reportReportedDate||"-"}</td>
    `;

    tableBody.appendChild(row);
  });
}

loadData();
</script>

</body>
</html>
